<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>实时数据</title>
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap-table.min.css">
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap-select.min.css">
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="../static/style/font-awesome.min.css">
    <link rel="stylesheet" href="../static/style/base.css">
    <script src="../static/script/jquery-3.3.1.min.js"></script>
    <script src="../static/highcharts/highcharts.js"></script>
    <script src="../static/script/bootstrap/bootstrap.min.js"></script>
    <script src="../static/script/bootstrap/bootstrap-table.min.js"></script>
    <script src="../static/script/bootstrap/bootstrap-table-zh-CN.min.js"></script>
    <script src="../static/script/bootstrap/bootstrap-select.min.js"></script>
    <script src="../static/script/bootstrap/bootstrap-datetimepicker.min.js"></script>
    <script src="../static/script/bootstrap/bootbox.min.js"></script>
    <script src="../static/script/jquery.select.js"></script>
    <script src="../static/script/base.js"></script>
    <script src="../static/script/bootstrapTableCommon.js"></script>
</head>
<body>
    <div class="col-md-12" style="padding:66px 0 0;">
        <div class="col-md-5">
            <div class="mics-panel-head">
                <div class="mics-panel-title pull-left">能耗趋势</div>
                <div class="mics-form-select pull-right">
                    <select name="" class="select selectFontKeepLeft" id="EnergyChartSelect_Time">
                        <option value="日">日</option>
                        <option value="月">月</option>
                        <option value="年">年</option>
                    </select>
                </div>
                <div class="mics-form-select pull-right">
                    <select name="" class="select selectFontKeepLeft" id="EnergyChartSelect_Item">
                        <option value="电">电</option>
                        <option value="水">水</option>
                        <option value="汽">汽</option>
                    </select>
                </div>
            </div>
            <div id="highchartsEnergy" style="min-width:400px;height:295px;margin-top: 15px;"></div>
        </div>
        <div class="col-md-3">
            <div class="mics-panel-head">
                <div class="mics-panel-title pull-left">分项能耗量</div>
                <div class="mics-form-select pull-right">
                    <select name="" class="select selectFontKeepLeft" id="EnergyProgressSelect_Time">
                        <option value="日">日</option>
                        <option value="月">月</option>
                        <option value="年">年</option>
                    </select>
                </div>
            </div>
            <ul class="EnergyNode">
                <li>
                    <div class="clearfix">
                        <div class="EnergyItemTitle pull-left">电能耗量 <span class="glyphicon glyphicon-arrow-down"></span></div>
                        <div class="EnergyItemData pull-right">65716457</div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-danger" role="progressbar"></div>
                    </div>
                </li>
                <li>
                    <div class="clearfix">
                        <div class="EnergyItemTitle pull-left">水能耗量 <span class="glyphicon glyphicon-arrow-down"></span></div>
                        <div class="EnergyItemData pull-right">65716457</div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar"></div>
                    </div>
                </li>
                <li>
                    <div class="clearfix">
                        <div class="EnergyItemTitle pull-left">汽能耗量 <span class="glyphicon glyphicon-arrow-down"></span></div>
                        <div class="EnergyItemData pull-right">65716457</div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-info" role="progressbar"></div>
                    </div>
                </li>
                <li>
                    <div class="clearfix">
                        <div class="EnergyItemTitle pull-left">其他能耗量 <span class="glyphicon glyphicon-arrow-down"></span></div>
                        <div class="EnergyItemData pull-right">65716457</div>
                    </div>
                    <div class="progress">
                        <div class="progress-bar progress-bar-success" role="progressbar"></div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="col-md-4">
            <div class="mics-panel-head">
                <div class="mics-panel-title pull-left">分项能耗趋势</div>
                <div class="mics-form-select pull-right"></div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="trendsChartContent dragscroll">
                        <div class="trendsChartItem mics-bg-primary">
                            <div class="form-group">电能</div>
                            <div class="form-group">8975.53</div>
                            <div class="form-group"><div class="row"><div id="highcharts-electricity" style="min-width:162px;height:74px"></div></div></div>
                            <div class="form-group">+1.465%</div>
                            <div class="form-group">87557.1</div>
                        </div>
                        <div class="trendsChartItem mics-bg-primary">
                            <div class="form-group">水能</div>
                            <div class="form-group">8975.53</div>
                            <div class="form-group"><div class="row"><div id="highcharts-electricity" style="min-width:162px;height:74px"></div></div></div>
                            <div class="form-group">+1.465%</div>
                            <div class="form-group">87557.1</div>
                        </div>
                        <div class="trendsChartItem mics-bg-primary">
                            <div class="form-group">汽能</div>
                            <div class="form-group">8975.53</div>
                            <div class="form-group"><div class="row"><div id="highcharts-electricity" style="min-width:162px;height:74px"></div></div></div>
                            <div class="form-group">+1.465%</div>
                            <div class="form-group">87557.1</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-12" style="padding:66px 0 0;height: 425px;">
        <div class="col-md-5">
            <div class="mics-panel-head">
                <div class="mics-form-select pull-left">
                    <select name="" class="select" id="EnergyAreaSelect">
                        <option value="生活区域能耗量">生活区域能耗量</option>
                        <option value="办公区域能耗量">办公区域能耗量</option>
                        <option value="其他区域能耗量">其他区域能耗量</option>
                    </select>
                </div>
                <div class="mics-form-select pull-right">
                    <select name="" class="select selectFontKeepLeft" id="EnergyAreaDateSelect">
                        <option value="日">日</option>
                        <option value="月">月</option>
                        <option value="年">年</option>
                    </select>
                </div>
            </div>
            <div class="EnergyAreaTable">
                <table>
                    <tbody>
                        <tr>
                            <td><div class="fontBlock"><span class="fa fa-flash"></span></div></td>
                            <td>电能耗量</td>
                            <td><span>45678964644</span></td>
                            <td><span>+1.2%</span></td>
                        </tr>
                        <tr>
                            <td><div class="fontBlock"><span class="fa fa-tint"></span></div></td>
                            <td>水能耗量</td>
                            <td><span>45678964644</span></td>
                            <td><span>+1.2%</span></td>
                        </tr>
                        <tr>
                            <td><div class="fontBlock"><span class="fa fa-tachometer"></span></div></td>
                            <td>汽能耗量</td>
                            <td><span>45678964644</span></td>
                            <td><span>+1.2%</span></td>
                        </tr>
                        <tr>
                            <td><div class="fontBlock"><span class="fa fa-ellipsis-h"></span></div></td>
                            <td>其他能耗量</td>
                            <td><span>45678964644</span></td>
                            <td><span>+1.2%</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-md-3">
            <div class="mics-panel-head">
                <div class="mics-panel-title pull-left">成本展示</div>
                <div class="mics-form-select pull-right">
                    <select name="" class="select selectFontKeepLeft" id="EnergyNumberSelect">
                        <option value="水能">水能</option>
                        <option value="电能">电能</option>
                        <option value="汽能">汽能</option>
                    </select>
                </div>
            </div>
            <div class="col-md-12">
                <div class="costData mics-bg-primary">
                    <ul class="costDataHead">
                        <li class="pull-left">成本</li>
                        <li class="pull-right">89757.12</li>
                    </ul>
                    <ul class="costDataContent">
                        <li class="bottomLeft">转化比</li>
                        <li class="bottomRight"><h3>32.45%</h3></li>
                    </ul>
                </div>
                <div class="costData mics-bg-primary">
                    <ul class="costDataHead">
                        <li class="pull-left">能耗成本</li>
                        <li class="pull-right">89757.12</li>
                    </ul>
                    <ul class="costDataContent">
                        <li id="costChart"></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="mics-panel-head">
                <div class="mics-panel-title pull-left">区域数据在线采集</div>
                <div class="mics-panel-title pull-right">All</div>
            </div>
            <div class="areaCollect">
                <table id="areaCollectTable"></table>
            </div>
        </div>
    </div>
    <div id="realTimeModal" class="modal mics-modal fade">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">实时数据</h4>
                </div>
                <div class="modal-body">
                    <div class="col-md-12">
                        <div class="col-md-7">
                            <form class="form-inline">
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control datetimepicker" id="startTime" readonly>
                                    </div>
                                    <div class="input-group">
                                        <input type="text" class="form-control datetimepicker" id="endTime" readonly>
                                    </div>
                                    <button type="button" class="btn btn-primary" id="SearchData">查询</button>
                                    <button type="button" class="btn btn-primary" id="seeRealTimeData">查看实时</button>
                                </div>
                            </form>
                            <div id="modalRealTimeChart" style="width: 100%;height: 410px;margin-top: 20px;"></div>
                            <div class="mics-panel-head">
                                <div class="mics-panel-title pull-left">累计能耗量:</div>
                            </div>
                            <div class="mics-panel-head">
                                <label for="" class="groupLabel">415461.13</label>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="mics-panel-head">
                                <div class="mics-panel-title pull-left">区域能耗排名:</div>
                            </div>
                            <div id="rankingChart" style="width: 100%;height: 200px;margin-top: 20px;">

                            </div>
                            <div class="mics-panel-head">
                                <div class="mics-panel-title pull-left">能耗数据统计:</div>
                            </div>
                            <div id="rankingChart" style="width: 100%;height: 200px;margin-top: 20px;">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" class="close" data-dismiss="modal">
                    <span class="fa fa-times"></span>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(function(){
            //时间选择控件
            $.fn.datetimepicker.dates['zh'] = {
                days:       ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六","星期日"],
                daysShort:  ["日", "一", "二", "三", "四", "五", "六","日"],
                daysMin:    ["日", "一", "二", "三", "四", "五", "六","日"],
                months:     ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月","十二月"],
                monthsShort:  ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],
                meridiem:    ["上午", "下午"],
                today:       "今天"
            };
            $('#startTime,#endTime').datetimepicker({
                format: 'yyyy-mm-dd hh:ii', // 标签上可用data-date-format="hh:ii" data-link-format="hh:ii"
                autoclose: true, //选择完成自动关闭下拉框
                startView : 2,
                minView:0, //0到分钟结束，1到小时，2到日
                language: 'zh-CN'
            })
            $('select.select').select();

            //能耗趋势图表
            ajaxEnergyTrend($("#EnergyChartSelect_Time").val(),$("#EnergyChartSelect_Item").val())
            $("#EnergyChartSelect_Time").siblings(".select").find(".select_ul li").on('click',function(){
                ajaxEnergyTrend($(this).html(),$("#EnergyChartSelect_Item").val())
            })
            $("#EnergyChartSelect_Item").siblings(".select").find(".select_ul li").on('click',function(){
                ajaxEnergyTrend($("#EnergyChartSelect_Time").val(),$(this).html())
            })
            function ajaxEnergyTrend(currenttime,classparam){
                $.ajax({
                    url:"/energyTrend",
                    type:"get",
                    data:{
                        currenttime:currenttime,
                        classparam:classparam
                    },
                    success:function(res){
                        res = JSON.parse(res)
                        highchartsRender("highchartsEnergy",res.X,res.Y)
                    }
                })
            }
            //进度条
            {#ajaxEnergyProgress($("#EnergyProgressSelect_Time").val())#}
            {#$("#EnergyProgressSelect_Time").siblings(".select").find(".select_ul li").on('click',function(){#}
            {#    ajaxEnergyProgress($(this).html())#}
            {# })#}
            {#function ajaxEnergyProgress(currenttime){#}
            {#    $.ajax({#}
            {#        url:"/energySumPercent",#}
            {#        type:"get",#}
            {#        data:{#}
            {#            currenttime:currenttime,#}
            {#        },#}
            {#        success:function(res){#}
            {#            res = JSON.parse(res)#}
            {#            console.log(res)#}
            {#        }#}
            {#    })#}
            {# }#}

            //获取实时数据
            var ws = new WebSocket("ws://127.0.0.1:5003");
            websocket()
            function websocket(){
                ws.onopen = function(){
                    ws.send("hello");
                    console.log("数据发送中...");
                };
                ws.onclose = function(){
                    console.log("连接已关闭...");
                };
            }
            //实时数据弹框
            $(".trendsChartItem").on("click",function(){
                $("#realTimeModal").modal('show')
                var chart = Highcharts.chart('modalRealTimeChart', {
                    chart: {
                        type: 'spline',
                        marginRight: 10,
                        events: {
                            load: function () {
                                var series = this.series[0],
                                    chart = this;
                                activeLastPointToolip(chart);
                                ws.onmessage = function (evt){
                                    var received_msg = evt.data;
                                    received_msg = JSON.parse(received_msg)
                                    var x = received_msg.randomtime,   // 返回时间
                                        y = received_msg.random;       // 返回值
                                    series.addPoint([x, y], true, true);
                                    activeLastPointToolip(chart);
                                };
                            }
                        }
                    },
                    title: {
                        text: null
                    },
                    xAxis: {
                        type: 'datetime',
                        tickPixelInterval: 150
                    },
                    yAxis: {
                        title: {
                            text: null
                        }
                    },
                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.series.name + '</b><br/>' +
                                Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                                Highcharts.numberFormat(this.y, 2);
                        }
                    },
                    credits: {
                        enabled: false//不显示LOGO
                    },
                    legend: {
                        enabled: false //不显示图例
                    },
                    series: [{
                        name: '随机数据',
                        data: (function () {
                            // 生成随机值
                            var data = [],
                                i;
                            for (i = -19; i <= 0; i += 1) {
                                data.push({
                                    x: null,
                                    y: null
                                });
                            }
                            return data;
                        }())
                    }]
                });
                websocket()
            })
        })
    </script>
</body>
</html>