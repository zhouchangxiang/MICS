<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>实时数据</title>
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../static/style/base.css">
    <script src="../static/script/jquery-3.3.1.min.js"></script>
    <script src="../static/script/jquery-ui.min.js"></script>
    <script src="../static/script/flowChart/jquery.jsPlumb-1.4.0-all.js"></script>
    <style>
        .aerialView{
            margin: 20px 0;
        }
        .area{
            position: relative;
            width: 100%;
            padding: 15px;
            font-size: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .area-A{
            height: 74px;
        }
        .area-B{
            height: 294px;
        }
        .area-C{
            height: 152px;
        }
        .area-D{
            height: 122px;
        }
        .area-E{
            height: 222px;
        }
        .area-F{
            height: 74px;
        }
        .area-G{
            height: 128px;
        }
        .area-use-bg{
            background:#EFF5FB;
            color:#333333;
            font-weight: bold;
        }
        .area-use-bg:hover{
            background:#07488E;
            color: #fff;
            cursor: pointer;
        }
        .area-unused-bg{
            background:#F9F9F9;
        }
        .clear-left-padding{
            padding-left: 0;
        }
        .clear-right-padding{
            padding-right: 0;
        }
        .connection{
            position: relative;
            width: 1px;
            height: 1px;
            background: #078E78;
            border-radius: 50%;
        }
        .connection-interchanger{
            width: 100px;
            height: 50px;
            line-height: 50px;
            margin: 100px auto;
            text-align: center;
            border-radius: 8px;
            color: #fff;
        }
        .area-name{
            position: absolute;
            bottom: 15px;
            right: 15px;
        }
        ._jsPlumb_endpoint,._jsPlumb_connector{
            z-index: 1;
        }
    </style>
</head>
<body>
    <div style="padding: 32px 15px 15px;">
        <div class="col-md-12 col-sm-12">
            <div class="clearfix">
                <div class="pull-left">
                    <ul>
                        <li class="form-group"><h4><b>厂区布局俯瞰导视预览</b></h4></li>
                        <li><span class="text-danger">注：接入转换机均为485转以太网</span></li>
                    </ul>
                </div>
            </div>
            <div class="aerialView" id="canvas">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="col-xs-2">
                            <div class="area area-A area-use-bg">
                                <div class="connection" id="area-item1"></div>
                                <div class="area-name">污水站</div>
                            </div>
                            <div class="area area-B area-use-bg">
                                <div class="connection" id="area-item2"></div>
                                <div class="area-name">原料库</div>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <div class="col-xs-6"><div class="area area-A area-unused-bg"></div></div>
                            <div class="col-xs-6"><div class="area area-A area-use-bg">
                                <div class="connection" id="area-item3"></div>
                                <div class="area-name">锅炉房</div>
                            </div></div>
                            <div class="col-xs-12"><div class="area area-C area-use-bg">
                                <div class="connection" id="area-item4"></div>
                                <div class="area-name">提取二车间</div>
                            </div></div>
                            <div class="col-xs-12"><div class="area area-D area-use-bg">
                                <div class="connection" id="area-item5"></div>
                                <div class="area-name">综合车间</div>
                            </div></div>
                        </div>
                        <div class="col-xs-2">
                            <div class="area area-B area-use-bg">
                                <div class="connection connection-interchanger" id="area-item6">汇聚交换机</div>
                                <div class="area-name">新建综合制剂楼</div>
                            </div>
                            <div class="col-xs-6 clear-left-padding"><div class="area area-A area-unused-bg"></div></div>
                            <div class="col-xs-6 clear-right-padding"><div class="area area-A area-unused-bg"></div></div>
                        </div>
                        <div class="col-xs-4">
                            <div class="area area-A area-unused-bg"><div class="area-name">高架库</div></div>
                            <div class="col-xs-6 clear-left-padding">
                                <div class="area area-B area-use-bg">
                                    <div class="connection" id="area-item7"></div>
                                    <div class="area-name">研发中心化验室</div>
                                </div>
                            </div>
                            <div class="col-xs-6 clear-right-padding">
                                <div class="area area-B area-use-bg">
                                    <div class="connection" id="area-item8"></div>
                                    <div class="area-name">前处理车间</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <div class="col-xs-2">
                            <div class="area area-E area-unused-bg"></div>
                        </div>
                        <div class="col-xs-2">
                            <div class="area area-E area-unused-bg"></div>
                        </div>
                        <div class="col-xs-5">
                            <div class="area area-E area-use-bg">
                                <div class="connection" id="area-item9"></div>
                                <div class="area-name">综合办公楼</div>
                            </div>
                        </div>
                        <div class="col-xs-3">
                            <div class="area area-F area-use-bg">
                                <div class="connection" id="area-item10"></div>
                                <div class="area-name">生物科技楼</div>
                            </div>
                            <div class="area area-G area-use-bg">
                                <div class="connection" id="area-item11"></div>
                                <div class="area-name">固体制剂车间</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button id="save">保存连线</button>
        </div>
    </div>
    <script>
        var list;
        var customList = [{
            sourceId:"area-item1",
            targetId:"area-item3"
        },{
            sourceId:"area-item2",
            targetId:"area-item4"
        }]
        jsPlumb.ready(function () {
            jsPlumb.importDefaults({
                DragOptions : { cursor: 'pointer'},	//拖动时鼠标停留在该元素上显示指针，通过css控制
                PaintStyle : { strokeStyle:'#666' },//元素的默认颜色
                EndpointStyle : { width:20, height:16, strokeStyle:'#666' },//连接点的默认颜色
                Endpoint : "Rectangle",//连接点的默认形状
                Anchors : ["TopCenter"],//连接点的默认位置
                Container:"canvas"
            });
            //连线时线和锚点的样式
            var exampleEndpoint = {
                endpoint:["Dot", { radius:6 }],//设置连接点的形状为圆形
                paintStyle:{ fillStyle:"#078E78" ,strokeStyle: '#ffffff',strokeWidth: 2},//设置连接点的样式
                isSource:true,	//是否可以拖动（作为连线起点）
                isTarget:true,	//是否可以放置（作为连线终点）
                //scope:"green dot",//连接点的标识符，只有标识符相同的连接点才能连接
                connectorStyle:{ strokeStyle:"#078E78", lineWidth:2,"dashstyle": "2 4" },//连线颜色、粗细
                connector: ["Straight"],//设置连线形状
                maxConnections:-1,//设置连接点最多可以连接几条线
                beforeDetach:function(conn) {	//绑定一个函数，在连线前弹出确认框
                    return confirm("确定要删除此条连接线吗?");
                }
            };
            // 默认连线的的样式
            var common = {
                endpoint: ["Dot", { radius:4 }],
                isSource:true,
                isTarget:true,
                paintStyle:{ strokeStyle: '#078E78', lineWidth:2,"dashstyle": "2 4"},//设置连接线的样式
                endpointStyle:{ fillStyle:"#078E78" },//连接点样式
                connector: ['Straight'],
                anchor: ['TopCenter']
            }
            jsPlumb.bind('click', function (connection, e) {
                jsPlumb.detach(connection)
            });

            //初始化锚点
            $.each($(".connection"),function(i,value){
                jsPlumb.addEndpoint($(this).attr("id"), exampleEndpoint);
            })
            //初始化连线
            $.each(customList,function(i,value){
                jsPlumb.connect({
                    source: customList[i].sourceId,
                    target: customList[i].targetId
                  }, common)
            })

            list = jsPlumb.getAllConnections();//获取所有的链接

        })
        $(function(){
            var listArr = []
            $("#save").on('click',function(){
                $.each(list.jsPlumb_DefaultScope,function(i,value){
                    var str = {}
                    str.sourceId = list.jsPlumb_DefaultScope[i].sourceId
                    str.targetId = list.jsPlumb_DefaultScope[i].targetId
                    listArr.push(str)
                })
                console.log(listArr)
            })
        })
    </script>
</body>
</html>