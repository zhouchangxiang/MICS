<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>成本中心</title>
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="../static/style/font-awesome.min.css">
    <link rel="stylesheet" href="../static/style/bootstrap/bootstrap-checkbox.css">
    <link rel="stylesheet" href="../static/style/base.css">
    <script src="../static/script/jquery-3.3.1.min.js"></script>
    <script src="../static/highcharts/highstock.js"></script>
    <script src="../static/highcharts/highcharts-zh_CN.js"></script>
    <script src="../static/script/bootstrap/bootstrap.min.js"></script>
    <script src="../static/script/bootstrap/bootstrap-datetimepicker.min.js"></script>
    <script src="../static/script/base.js"></script>
    <style>
        .aerialView{
            margin: 20px 0;
        }
        .area{
            position: relative;
            width: 100%;
            padding: 15px;
            font-size: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .area-A{
            height: 74px;
        }
        .area-B{
            height: 294px;
        }
        .area-C{
            height: 152px;
        }
        .area-D{
            height: 122px;
        }
        .area-E{
            height: 222px;
        }
        .area-F{
            height: 74px;
        }
        .area-G{
            height: 128px;
        }
        .area-use-bg{
            background:#EFF5FB;
            color:#333333;
            font-weight: bold;
        }
        .area-use-bg:hover{
            background:#07488E;
            color: #fff;
            cursor: pointer;
        }
        .area-use-bg.area-use-active{
            background:#07488E;
            color: #fff;
        }
        .area-unused-bg{
            background:#F9F9F9;
        }
        .clear-left-padding{
            padding-left: 0;
        }
        .clear-right-padding{
            padding-right: 0;
        }
        .connection{
            position: relative;
            width: 1px;
            height: 1px;
            background: #078E78;
            border-radius: 50%;
        }
        .connection-interchanger{
            display: table;
            margin: 20px auto;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            color: #fff;
        }
        .area-name{
            position: absolute;
            bottom: 15px;
            right: 15px;
        }
    </style>
</head>
<body>
    <div style="padding: 32px 15px 15px;">
        <div class="col-sm-12">
            <div class="col-sm-9">
                <div class="aerialView" id="canvas">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="col-xs-2">
                            <div class="area area-A area-use-bg">
                                <div class="connection" id="area-item1"></div>
                                <div class="area-name">污水站</div>
                            </div>
                            <div class="area area-C area-unused-bg">
                                <div class="area-name">原料库</div>
                            </div>
                            <div class="area area-D area-unused-bg"></div>
                        </div>
                        <div class="col-xs-4">
                            <div class="col-xs-6"><div class="area area-A area-unused-bg"></div></div>
                            <div class="col-xs-6"><div class="area area-A area-use-bg">
                                <div class="connection" id="area-item2"></div>
                                <div class="area-name">锅炉房</div>
                            </div></div>
                            <div class="col-xs-12"><div class="area area-C area-use-bg">
                                <div class="connection" id="area-item3"></div>
                                <div class="area-name">提取二车间</div>
                            </div></div>
                            <div class="col-xs-12"><div class="area area-D area-use-bg">
                                <div class="connection" id="area-item4"></div>
                                <div class="area-name">综合车间</div>
                            </div></div>
                        </div>
                        <div class="col-xs-2">
                            <div class="area area-B area-use-bg area-use-active">
                                <div class="connection connection-interchanger" id="area-item5">汇聚交换机</div>
                                <div class="area-name">新建综合制剂车间</div>
                            </div>
                            <div class="col-xs-6 clear-left-padding"><div class="area area-A area-unused-bg"></div></div>
                            <div class="col-xs-6 clear-right-padding"><div class="area area-A area-unused-bg"></div></div>
                        </div>
                        <div class="col-xs-4">
                            <div class="col-xs-6"><div class="area area-A area-use-bg">
                                <div class="connection" id="area-item6"></div>
                                <div class="area-name">研发中心</div>
                            </div></div>
                            <div class="col-xs-6"><div class="area area-A area-use-bg">
                                <div class="connection" id="area-item7"></div>
                                <div class="area-name">前处理车间</div>
                            </div></div>
                            <div class="col-xs-12"><div class="area area-C area-use-bg">
                                <div class="connection" id="area-item8"></div>
                                <div class="area-name">好护士健康科技车间</div>
                            </div></div>
                            <div class="col-xs-12"><div class="area area-D area-use-bg">
                                <div class="connection" id="area-item9"></div>
                                <div class="area-name">固体制剂车间</div>
                            </div></div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <div class="col-xs-2">
                            <div class="area area-E area-unused-bg"></div>
                        </div>
                        <div class="col-xs-2">
                            <div class="area area-E area-use-bg">
                                <div class="connection" id="area-item10"></div>
                                <div class="area-name">展览室</div>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <div class="area area-E area-use-bg">
                                <div class="connection" id="area-item11"></div>
                                <div class="area-name">办公楼＼食堂</div>
                            </div>
                        </div>
                        <div class="col-xs-4">
                            <div class="area area-E area-unused-bg"></div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <div class="col-sm-3">
                <div class="block-separate">
                    <div class="form-group">
                        <input type="text" class="form-control input-sm datetimepicker" id="dateTime" readonly>
                    </div>
                    <div class="form-group">
                        <div class="mics-btn-group btn-group btn-group-xs" role="group" id="datetimepickerBtnGroup" style="width: 100%;">
                            <button type="button" class="btn" style="width: 33.3%;">年</button>
                            <button type="button" class="btn" style="width: 33.3%;">月</button>
                            <button type="button" class="btn" style="width: 33.3%;">日</button>
                        </div>
                    </div>
                </div>
                <div class="block-separate">
                    <div id="EnergyCostChart" style="width: 100%;min-height: 260px;"></div>
                </div>
                <div class="mics-panel-head">
                    <div class="mics-panel-title pull-left">区域成本排名:</div>
                </div>
                <div id="rankingChart" style="width: 100%;margin-top: 20px;min-height: 400px;"></div>
            </div>
        </div>
    </div>
    <script>
        $(function(){
            //时间选择控件
            $.fn.datetimepicker.dates['zh'] = {
                days:       ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六","星期日"],
                daysShort:  ["日", "一", "二", "三", "四", "五", "六","日"],
                daysMin:    ["日", "一", "二", "三", "四", "五", "六","日"],
                months:     ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月","十二月"],
                monthsShort:  ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],
                meridiem:    ["上午", "下午"],
                today:       "今天"
            };

            $('#dateTime').datetimepicker({
                format: 'yyyy-mm-dd', // 标签上可用data-date-format="hh:ii" data-link-format="hh:ii"
                autoclose: true, //选择完成自动关闭下拉框
                startView : 2,
                minView:2, //0到分钟结束，1到小时，2到日
                language: 'zh-CN'
            })
            $("#dateTime").val(myDayformatter(new Date()))

            $(".area-use-bg").on('click',function(){
                $(".area-use-bg").each(function(){
                    $(this).removeClass("area-use-active")
                })
                $(this).addClass("area-use-active")
                var DateTime = $("#datetimepickerBtnGroup").find(".active").html()
                console.log(DateTime)
                var CurrentTime = ""
                if(DateTime == "年"){
                    CurrentTime = myYearformatter(new Date($("#dateTime").val()))
                    getEnergyData(CurrentTime,DateTime)
                    getEnergyRankingData(CurrentTime,DateTime)
                }else if(DateTime == "月"){
                    CurrentTime = myMonthformatter(new Date($("#dateTime").val()))
                    getEnergyData(CurrentTime,DateTime)
                    getEnergyRankingData(CurrentTime,DateTime)
                }else if(DateTime == "日"){
                    CurrentTime = myDayformatter(new Date($("#dateTime").val()))
                    getEnergyData(CurrentTime,DateTime)
                    getEnergyRankingData(CurrentTime,DateTime)
                }
            })

            $("#datetimepickerBtnGroup").on("click",".btn",function(){
                $(this).addClass("active").siblings().removeClass("active")
                var CurrentTime = ""
                if($(this).html() == "年"){
                    CurrentTime = myYearformatter(new Date($("#dateTime").val()))
                    getEnergyData(CurrentTime,$(this).html())
                    getEnergyRankingData(CurrentTime,$(this).html())
                }else if($(this).html() == "月"){
                    CurrentTime = myMonthformatter(new Date($("#dateTime").val()))
                    getEnergyData(CurrentTime,$(this).html())
                    getEnergyRankingData(CurrentTime,$(this).html())
                }else if($(this).html() == "日"){
                    CurrentTime = myDayformatter(new Date($("#dateTime").val()))
                    getEnergyData(CurrentTime,$(this).html())
                    getEnergyRankingData(CurrentTime,$(this).html())
                }
            })
            $("#datetimepickerBtnGroup .btn").eq(0).click()

            function getEnergyData(CurrentTime,DateTime){
                var Area = $(".area-use-active").find(".area-name").html()
                $.ajax({
                    url:"/energyall",
                    type:"get",
                    data:{
                        CurrentTime : CurrentTime,
                        DateTime: DateTime,
                        Area: Area,
                        ModelFlag:"区域成本"
                    },
                    success:function (res) {
                        res = JSON.parse(res)
                        Highcharts.chart('EnergyCostChart',{
                            chart: {
                                type: 'bar'
                            },
                            title: {
                                text: Area + "能耗成本"
                            },
                            subtitle: {
                                text: ''
                            },
                            credits: {
                                enabled: false//不显示LOGO
                            },
                            legend: {
                                enabled: false //不显示图例
                            },
                            xAxis: {
                                categories: res.X
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: null
                                }
                            },
                            series: [{
                                name: '成本值',
                                data: res.Y
                            }]
                        });
                    }
                })
            }
            //成本排名
            function getEnergyRankingData(CurrentTime,DateTime){
                $.ajax({
                    url:"/energyall",
                    type:"get",
                    data:{
                        CurrentTime : CurrentTime,
                        DateTime: DateTime,
                        ModelFlag:"区域成本排名"
                    },
                    success:function (res) {
                        res = JSON.parse(res)
                        Highcharts.chart('rankingChart',{
                            chart: {
                                type: 'bar'
                            },
                            title: {
                                text: null
                            },
                            subtitle: {
                                text: ''
                            },
                            credits: {
                                enabled: false//不显示LOGO
                            },
                            legend: {
                                enabled: false //不显示图例
                            },
                            xAxis: {
                                categories: res.X
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: null
                                }
                            },
                            series: [{
                                name: '成本值',
                                data: res.Y
                            }]
                        });
                    }
                })
            }
        })
    </script>
</body>
</html>
